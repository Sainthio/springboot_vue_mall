# JMeter性能测试操作指南

## 📋 目录
1. [JMeter安装](#1-jmeter安装)
2. [快速测试（5分钟完成）](#2-快速测试5分钟完成)
3. [详细测试步骤](#3-详细测试步骤)
4. [测试结果截图](#4-测试结果截图)
5. [测试数据说明](#5-测试数据说明)

---

## 1. JMeter安装

### 下载地址
https://jmeter.apache.org/download_jmeter.cgi

### 安装步骤
```bash
1. 下载 apache-jmeter-5.6.zip
2. 解压到任意目录
3. 进入 bin 目录
4. 双击 jmeter.bat（Windows）启动
```

### 验证安装
启动后看到JMeter主界面即表示安装成功。

---

## 2. 快速测试（5分钟完成）

### 场景1：商品查询性能测试

#### Step 1：创建测试计划
1. 启动JMeter
2. 右键点击"测试计划" → 添加 → Threads(Users) → 线程组
3. 配置线程组：
   - 线程数：**100**
   - Ramp-Up时间：**10**
   - 循环次数：**10**

#### Step 2：添加HTTP请求
1. 右键点击"线程组" → 添加 → Sampler → HTTP请求
2. 配置HTTP请求：
   - 协议：`http`
   - 服务器名称：`localhost`
   - 端口号：`8080`
   - 路径：`/springbootol3q1/shangpinxinxi/page`
   - 方法：`GET`
   - 添加参数：
     - page: 1
     - limit: 10

#### Step 3：添加结果监听器
1. 右键点击"线程组" → 添加 → 监听器 → **聚合报告**
2. 右键点击"线程组" → 添加 → 监听器 → **察看结果树**
3. 右键点击"线程组" → 添加 → 监听器 → **图形结果**

#### Step 4：运行测试
1. 点击工具栏的▶️（绿色三角）按钮
2. 等待测试完成
3. 查看"聚合报告"

#### Step 5：保存截图
1. 点击聚合报告
2. 按 `Alt + PrintScreen` 截图
3. 保存为 `商品查询性能测试-100并发.png`

---

### 场景2：秒杀场景测试（防超卖验证）⭐重点

#### Step 1：准备测试数据
```sql
-- 在数据库中创建一个测试商品
INSERT INTO shangpinxinxi (
    id, shangpinbianhao, shangpinmingcheng, 
    price, alllimittimes, reversetime
) VALUES (
    9999, 'TEST001', '测试商品', 
    99.99, 100, '2025-12-31 23:59:59'
);
```

#### Step 2：创建测试计划
1. 新建线程组
2. 配置线程组：
   - 线程数：**500**（模拟500人抢购）
   - Ramp-Up时间：**10**
   - 循环次数：**1**

#### Step 3：添加HTTP请求
1. 协议：`http`
2. 服务器：`localhost`
3. 端口：`8080`
4. 路径：`/springbootol3q1/orders/add`
5. 方法：**POST**
6. 请求体（Body Data）：
```json
{
    "tablename": "shangpinxinxi",
    "userid": 11,
    "goodid": 9999,
    "goodname": "测试商品",
    "buynumber": 1,
    "price": 99.99,
    "total": 99.99,
    "address": "测试地址"
}
```
7. 添加HTTP信息头管理器：
   - Content-Type: `application/json`

#### Step 4：运行测试
1. 点击运行
2. 等待完成（约1分钟）
3. 查看聚合报告

#### Step 5：验证结果
```sql
-- 查询成功的订单数
SELECT COUNT(*) FROM orders WHERE goodid = 9999;
-- 应该显示：100

-- 查询商品库存
SELECT alllimittimes FROM shangpinxinxi WHERE id = 9999;
-- 应该显示：0

-- 结论：成功100个，库存为0，无超卖！
```

#### Step 6：截图保存
1. 截图1：JMeter聚合报告
2. 截图2：数据库订单表查询结果
3. 截图3：数据库商品库存查询结果

---

## 3. 详细测试步骤

### 3.1 商品查询不同并发测试

按照以下并发数分别测试：

| 测试轮次 | 并发数 | Ramp-Up | 循环次数 | 保存文件名 |
|---------|--------|---------|---------|-----------|
| 测试1 | 100 | 10 | 10 | 商品查询-100并发.png |
| 测试2 | 500 | 10 | 10 | 商品查询-500并发.png |
| 测试3 | 1000 | 10 | 10 | 商品查询-1000并发.png |

**操作步骤：**
1. 修改线程组的线程数
2. 清空之前的结果：运行 → 清除全部
3. 点击运行
4. 等待完成
5. 截图保存

### 3.2 秒杀场景不同并发测试

| 测试轮次 | 并发数 | 初始库存 | 预期成功 | 保存文件名 |
|---------|--------|---------|---------|-----------|
| 测试1 | 100 | 100 | 100 | 秒杀-100并发.png |
| 测试2 | 500 | 100 | 100 | 秒杀-500并发.png |
| 测试3 | 1000 | 100 | 100 | 秒杀-1000并发.png |

**每次测试前：**
```sql
-- 重置商品库存
UPDATE shangpinxinxi SET alllimittimes = 100 WHERE id = 9999;

-- 清空测试订单
DELETE FROM orders WHERE goodid = 9999;
```

---

## 4. 测试结果截图

### 4.1 需要的截图列表

#### 必需截图（用于报告）：

**1. JMeter聚合报告截图**
- 文件名：`JMeter聚合报告-1000并发.png`
- 内容：显示样本数、平均值、中位数、异常率等
- 用途：放在报告的"性能测试"章节

**2. 秒杀测试聚合报告**
- 文件名：`秒杀测试-500并发.png`
- 内容：显示500个请求的测试结果
- 用途：证明防超卖功能

**3. 数据库验证截图**
- 文件名：`防超卖验证-订单数.png`
- 内容：
```sql
SELECT COUNT(*) as 成功订单数 FROM orders WHERE goodid = 9999;
```
- 用途：证明订单数正确

**4. 数据库库存截图**
- 文件名：`防超卖验证-库存.png`
- 内容：
```sql
SELECT alllimittimes as 剩余库存 FROM shangpinxinxi WHERE id = 9999;
```
- 用途：证明库存正确扣减

#### 可选截图（增强说明）：

**5. 图形结果截图**
- 文件名：`性能测试-响应时间图.png`
- 内容：显示响应时间曲线图

**6. 查看结果树截图**
- 文件名：`请求响应示例.png`
- 内容：显示成功和失败的请求

---

### 4.2 截图技巧

#### 使用JMeter内置截图工具
1. 在聚合报告上右键
2. 选择"保存表格数据"
3. 选择格式：PNG
4. 保存

#### 使用系统截图
1. 切换到要截图的窗口
2. 按 `Alt + PrintScreen`（只截当前窗口）
3. 打开画图工具
4. `Ctrl + V` 粘贴
5. 保存

#### 美化截图（推荐）
1. 使用 **Snipaste** 工具（免费）
2. 按 `F1` 截图
3. 可以标注、添加箭头
4. 按 `Ctrl + S` 保存

---

## 5. 测试数据说明

### 5.1 聚合报告字段说明

| 字段名 | 中文名 | 说明 |
|--------|--------|------|
| Label | 标签 | 请求名称 |
| # Samples | 样本数 | 总请求次数 |
| Average | 平均值 | 平均响应时间（ms） |
| Median | 中位数 | 50%请求的响应时间 |
| 90% Line | 90%百分位 | 90%请求的响应时间 |
| 95% Line | 95%百分位 | 95%请求的响应时间 |
| 99% Line | 99%百分位 | 99%请求的响应时间 |
| Min | 最小值 | 最快响应时间 |
| Max | 最大值 | 最慢响应时间 |
| Error % | 异常率 | 失败请求的百分比 |
| Throughput | 吞吐量 | 每秒处理的请求数 |

### 5.2 如何判断测试结果好坏

#### 优秀标准
- 平均响应时间 < 500ms
- 异常率 < 1%
- 吞吐量 > 1000 TPS

#### 良好标准
- 平均响应时间 < 1000ms
- 异常率 < 5%
- 吞吐量 > 500 TPS

#### 需要优化
- 平均响应时间 > 2000ms
- 异常率 > 10%

---

## 6. 常见问题

### Q1：测试时报错"连接被拒绝"
**解决：** 确保后端项目已启动，访问 http://localhost:8080/springbootol3q1 能正常访问

### Q2：所有请求都失败
**解决：** 
1. 检查URL路径是否正确
2. 检查端口号是否正确
3. 检查HTTP方法（GET/POST）是否正确

### Q3：秒杀测试时发现超卖
**解决：** 
1. 检查数据库连接是否正常
2. 检查防超卖的SQL是否正确
3. 确认事务是否开启

### Q4：测试结果不稳定
**解决：** 
1. 每次测试前清空结果
2. 重启后端服务
3. 增加Ramp-Up时间

---

## 7. 快速测试脚本

### 一键清空测试数据
```sql
-- 重置测试商品
DELETE FROM shangpinxinxi WHERE id = 9999;
INSERT INTO shangpinxinxi (
    id, shangpinbianhao, shangpinmingcheng, 
    price, alllimittimes, reversetime, addtime
) VALUES (
    9999, 'TEST001', '测试商品-JMeter', 
    99.99, 100, '2025-12-31 23:59:59', NOW()
);

-- 清空测试订单
DELETE FROM orders WHERE goodid = 9999;
```

### 验证测试结果
```sql
-- 1. 查看订单数
SELECT 
    '成功订单数' as 项目,
    COUNT(*) as 数量
FROM orders 
WHERE goodid = 9999 AND status = '已支付';

-- 2. 查看库存
SELECT 
    '剩余库存' as 项目,
    alllimittimes as 数量
FROM shangpinxinxi 
WHERE id = 9999;

-- 3. 验证是否超卖
SELECT 
    CASE 
        WHEN (SELECT COUNT(*) FROM orders WHERE goodid = 9999) <= 100 
        THEN '✅ 无超卖'
        ELSE '❌ 发生超卖'
    END as 测试结果;
```

---

## 8. 测试报告数据填写

根据JMeter测试结果，填写到报告中：

### 表格模板

```
| 并发用户数 | 平均响应时间 | 中位数响应时间 | 90%响应时间 | 异常率 | 吞吐量(次/秒) |
|-----------|-------------|---------------|------------|--------|--------------|
| 100       | [填写]ms    | [填写]ms      | [填写]ms   | [填写]%| [填写]       |
| 500       | [填写]ms    | [填写]ms      | [填写]ms   | [填写]%| [填写]       |
| 1000      | [填写]ms    | [填写]ms      | [填写]ms   | [填写]%| [填写]       |
```

### 数据来源
- **平均响应时间**：JMeter聚合报告的 `Average` 列
- **中位数**：JMeter聚合报告的 `Median` 列
- **90%响应时间**：JMeter聚合报告的 `90% Line` 列
- **异常率**：JMeter聚合报告的 `Error %` 列
- **吞吐量**：JMeter聚合报告的 `Throughput` 列

---

## 9. 10分钟完成测试的流程

```
1. [1分钟] 启动JMeter
2. [2分钟] 创建线程组和HTTP请求（100并发）
3. [1分钟] 添加聚合报告
4. [1分钟] 运行测试
5. [2分钟] 截图保存
6. [1分钟] 修改为500并发，重复测试
7. [2分钟] 截图保存

总计：10分钟
```

---

## 10. 测试检查清单

测试前：
- [ ] 后端项目已启动
- [ ] 数据库连接正常
- [ ] 测试数据已准备
- [ ] JMeter已安装

测试中：
- [ ] 线程数配置正确
- [ ] HTTP请求路径正确
- [ ] 已添加聚合报告
- [ ] 测试正常运行

测试后：
- [ ] 已保存聚合报告截图
- [ ] 已验证数据库结果
- [ ] 已保存数据库截图
- [ ] 已记录测试数据

---

**提示：** 如果时间紧张，至少完成：
1. ✅ 100并发商品查询测试（1个截图）
2. ✅ 500并发秒杀测试（3个截图：JMeter+订单数+库存）

这样就有足够的测试数据用于答辩了！

---

**祝测试顺利！** 🎉
